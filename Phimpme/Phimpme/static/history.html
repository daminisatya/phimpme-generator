<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title> History </title>
  <meta http-equiv="content-type" content="text/html,no-cache; charset=utf-8">
  <script type="text/javascript" src="/static/js/jquery-1.10.2.min.js"></script>
  <script type="text/javascript">
	function renovateList(){
		$.ajax({
			url : "/cgi-bin/orders/review/",
			type : "POST",
			success : function(data) {
				var json = eval("(" + data + ")");

				if (json.result == "success") {
					createList(json.data);
					return;
				}if (json.result == "noauth") {
					location.href="/static/login.html";
					return;
				}else{
					location.href="/static/error.html";
					return;
				}
			}
		});
	}
	function renovateOneList(id){
		$.ajax({
			url : "/cgi-bin/defray/pay/",
			type : "POST",
			data:{
				id:id
			},
			success : function(data) {
				var json = eval("(" + data + ")");

				if (json.result == "success") {
					renovateList();
					return;
				}if (json.result == "noauth") {
					location.href="/static/login.html";
					return;
				}else{
					location.href="/static/error.html";
					return;
				}
			}
		});
	}
	function createList(transData){
		$("#renovateTable *").remove();
		for(var i = 0,iLen=transData.length;i <iLen; i++){
			var tmpDiv="<table><tr><td width='10%'>Order Number</td><td width='25%'>App Name</td><td width='10%'>Price</td><td width='10%'>Status</td><td width='15%'>Operation</td></tr>";
			var tempArray=(transData[i].content).split(",");
			tmpDiv+="<tr>";
			for(var j = 0,jLen=tempArray.length;j <jLen; j++){
				tmpDiv+="<td>"+tempArray[j]+"</td>";
			}

			if(transData[i].status==0){
				tmpDiv+="<td colspan='2'><input type='button' value='Pay' onclick='renovateOneList("+transData[i].id+");'/></td>";
			} else if (transData[i].status==1) {
				tmpDiv+="<td colspan='2'><a >please wait...</a></td>";
			} else {
				tmpDiv+="<td colspan='2'><a href=\""+transData[i].refer+"\">Download</a></td>";
			}
			tmpDiv+="<tr>";
			tmpDiv+="<table>";
			$("#renovateTable").append(tmpDiv);
		}
	}
	$(document).ready(function(){
		renovateList();
	})
  </script>
 </head>

 <body>
 <div>
<a style="display: block;float: left;" href='/cgi-bin/usermgt/logout/' >Log out</a><a style="display: block;float: right;" href='/static/app_config.html' >Configure new</a>
</div>
	 <DIV>
		<H1>List</H1>
		<div id="renovateTable"></div>
	</DIV>
 </body>
</html>
